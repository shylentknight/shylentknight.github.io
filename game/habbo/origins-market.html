<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Habbo Origins Community Market</title>
    <style>
        :root { --hc-blue: #2980b9; --gold: #f1c40f; --dark: #2c3e50; }
        body { font-family: 'Tahoma', sans-serif; background: #f4f7f6; padding: 20px; }
        .container { max-width: 1000px; margin: auto; }
        
        /* Form Styling */
        .add-box { background: white; padding: 20px; border-radius: 10px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); margin-bottom: 30px; }
        .input-group { display: flex; flex-wrap: wrap; gap: 10px; }
        input, select { padding: 10px; border: 1px solid #ccc; border-radius: 5px; flex: 1; min-width: 150px; }
        .btn-add { background: #27ae60; color: white; border: none; padding: 10px 20px; cursor: pointer; font-weight: bold; border-radius: 5px; }

        /* Stall Grid */
        .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 20px; }
        .stall { background: white; border-radius: 10px; border: 1px solid #ddd; overflow: hidden; }
        .owner-header { background: var(--dark); color: white; padding: 12px; font-weight: bold; display: flex; justify-content: space-between; }
        .item-row { display: flex; justify-content: space-between; align-items: center; padding: 10px; border-bottom: 1px solid #eee; }
        .btn-del { background: #ff7675; color: white; border: none; padding: 2px 8px; border-radius: 4px; cursor: pointer; font-size: 0.8em; }
        
        .price { font-weight: bold; color: var(--hc-blue); margin-right: 10px; }
    </style>
</head>
<body>

<div class="container">
    <div class="add-box">
        <h3>âž• Add Your Item to the Market</h3>
        <div class="input-group">
            <input type="text" id="owner" placeholder="Your Habbo Name">
            <input type="text" id="item" placeholder="Item Name">
            <input type="text" id="price" placeholder="Price (e.g. 10c)">
            <select id="cat">
                <option value="Rare">ðŸ’Ž Rare</option>
                <option value="HC">ðŸŽ© HC</option>
                <option value="Norm">ðŸ“¦ Norm</option>
            </select>
            <input type="password" id="pin" placeholder="Set 4-Digit PIN">
            <button class="btn-add" onclick="addItem()">Post Item</button>
        </div>
        <p style="font-size: 0.8em; color: #666;">*Remember your PIN! You'll need it to remove the item once sold.</p>
    </div>

    <div id="grid" class="grid">Loading items...</div>
</div>

<script>
    const WEB_APP_URL = 'https://script.google.com/macros/s/AKfycbwDKeuSW6fjOSART5Vy2PJTgt1ufdUIYi57Duugau6Lqb1dyVL-_Ca7aOssVyeOoPzF/exec';

    async function addItem() {
        const data = {
            owner: document.getElementById('owner').value,
            item: document.getElementById('item').value,
            price: document.getElementById('price').value,
            category: document.getElementById('cat').value,
            pin: document.getElementById('pin').value,
            action: "add"
        };
        if(!data.owner || !data.item || !data.pin) return alert("Please fill in Name, Item, and PIN.");

        await fetch(WEB_APP_URL, { method: 'POST', mode: 'no-cors', body: JSON.stringify(data) });
        alert("Item Added!");
        location.reload(); 
    }

    async function deleteItem(owner, item) {
        const pin = prompt(`Enter PIN for ${owner}'s ${item} to remove it:`);
        if(!pin) return;

        const data = { action: "delete", owner, item, pin };
        
        const response = await fetch(WEB_APP_URL, { 
            method: 'POST', 
            body: JSON.stringify(data) 
        });
        const result = await response.text();
        
        if(result === "Deleted") {
            alert("Item removed!");
            location.reload();
        } else {
            alert("Incorrect PIN or error.");
        }
    }

    async function loadData() {
        const response = await fetch(WEB_APP_URL);
        const rawData = await response.json();
        const grid = document.getElementById('grid');
        grid.innerHTML = '';

        const stalls = {};
        rawData.forEach(row => {
            const [owner, item, price, time, cat] = row;
            if(!stalls[owner]) stalls[owner] = [];
            stalls[owner].push({item, price, cat});
        });

        for(const owner in stalls) {
            let itemsHtml = stalls[owner].map(x => `
                <div class="item-row">
                    <span>${x.item} <br><small style="color:#999">${x.cat}</small></span>
                    <div>
                        <span class="price">${x.price}</span>
                        <button class="btn-del" onclick="deleteItem('${owner}', '${x.item}')">Remove</button>
                    </div>
                </div>`).join('');

            grid.innerHTML += `<div class="stall"><div class="owner-header">ðŸ‘¤ ${owner}</div>${itemsHtml}</div>`;
        }
    }

    loadData();
</script>
</body>
</html>