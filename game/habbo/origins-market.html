<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Habbo Origins Community Market</title>
<style>
    /* New Category Badge Colors */
    .cat-badge { font-size: 0.65em; padding: 3px 7px; border-radius: 4px; font-weight: bold; text-transform: uppercase; margin-right: 8px; }
    
    .cat-Rare { background: #f1c40f; color: #000; }
    .cat-Funky-Friday { background: #9b59b6; color: #fff; }
    .cat-Seasonal { background: #e67e22; color: #fff; }
    .cat-Super-Rare { background: #fd79a8; color: #fff; border: 1px solid #e84393; }
    .cat-Noco { background: #dfe6e9; color: #2d3436; border: 1px solid #b2bec3; }
    .cat-HC { background: #3498db; color: #fff; }
    .cat-Norm { background: #95a5a6; color: #fff; }
</style>

</head>
<body>

<div class="container">
    <div class="add-box">
        <h3>âž• Add Your Item to the Market</h3>
        <div class="input-group">
            <input type="text" id="owner" placeholder="Your Habbo Name">
            <input type="text" id="item" placeholder="Item Name">
            <input type="text" id="price" placeholder="Price (e.g. 10c)">
            <select id="cat" style="width: 95%; padding: 10px; margin: 10px 0;">
              <option value="Rare">ðŸ’Ž Rare</option>
              <option value="Funky Friday">ðŸŽ¸ Funky Friday</option>
              <option value="Seasonal">ðŸŽƒ Seasonal</option>
              <option value="Super Rare">ðŸŒŸ Super Rare</option>
              <option value="Noco">âšª Noco</option>
              <option value="HC">ðŸŽ© HC Item</option>
              <option value="Norm">ðŸ“¦ Norm</option>
            </select>
            <input type="password" id="pin" placeholder="Set 4-Digit PIN">
            <button class="btn-add" onclick="addItem()">Post Item</button>
        </div>
        <p style="font-size: 0.8em; color: #666;">*Remember your PIN! You'll need it to remove the item once sold.</p>
    </div>

    <div id="grid" class="grid">Loading items...</div>
</div>

<script>
    const WEB_APP_URL = 'https://script.google.com/macros/s/AKfycbwDKeuSW6fjOSART5Vy2PJTgt1ufdUIYi57Duugau6Lqb1dyVL-_Ca7aOssVyeOoPzF/exec';

    async function addItem() {
        const data = {
            owner: document.getElementById('owner').value,
            item: document.getElementById('item').value,
            price: document.getElementById('price').value,
            category: document.getElementById('cat').value,
            pin: document.getElementById('pin').value,
            action: "add"
        };
        if(!data.owner || !data.item || !data.pin) return alert("Please fill in Name, Item, and PIN.");

        await fetch(WEB_APP_URL, { method: 'POST', mode: 'no-cors', body: JSON.stringify(data) });
        alert("Item Added!");
        location.reload(); 
    }

    async function deleteItem(owner, item) {
        const pin = prompt(`Enter PIN for ${owner}'s ${item} to remove it:`);
        if(!pin) return;

        const data = { action: "delete", owner, item, pin };
        
        const response = await fetch(WEB_APP_URL, { 
            method: 'POST', 
            body: JSON.stringify(data) 
        });
        const result = await response.text();
        
        if(result === "Deleted") {
            alert("Item removed!");
            location.reload();
        } else {
            alert("Incorrect PIN or error.");
        }
    }

async function loadData() {
    const response = await fetch(WEB_APP_URL);
    const rawData = await response.json();
    const grid = document.getElementById('grid');
    grid.innerHTML = '';

    const stalls = {};
    rawData.forEach(row => {
        // [0]=Owner, [1]=Item, [2]=Price, [3]=Time, [4]=Category
        const [owner, item, price, time, cat] = row;
        if(!stalls[owner]) stalls[owner] = [];
        stalls[owner].push({item, price, cat});
    });

    for(const owner in stalls) {
        // --- START OF RENDER LOGIC ---
        let itemsHtml = stalls[owner].map(x => {
            
            // This is the logic for the Category CSS class
            // It turns "Funky Friday" into "Funky-Friday" so the CSS can read it
            const categoryClass = x.cat ? x.cat.replace(/\s+/g, '-') : 'Rare';

            return `
                <div class="item-row">
                    <span>
                        <span class="cat-badge cat-${categoryClass}">${x.cat}</span>
                        ${x.item}
                    </span>
                    <div>
                        <span class="price">${x.price}</span>
                        <button class="btn-del" onclick="deleteItem('${owner}', '${x.item}')">Ã—</button>
                    </div>
                </div>`;
        }).join('');
        // --- END OF RENDER LOGIC ---

        grid.innerHTML += `<div class="stall"><div class="owner-header">ðŸ‘¤ ${owner}</div>${itemsHtml}</div>`;
    }
}

    loadData();
</script>
</body>
</html>